# 📘 02. 시작하기 (Getting Started)

pgvector를 처음 사용하는 개발자를 위한 기본 사용 가이드  
이 문서에서는 아래 내용을 설명합니다.

1\) Extension 활성화  
2\) 벡터 컬럼 생성  
3\) 벡터 삽입  
4\) 최근접 이웃 검색  
5\) 기본 쿼리  

---

## 1) Extension 활성화

pgvector를 사용하려면 먼저 데이터베이스에서 extension을 활성화해야 한다.  
이미 pgvector extension을 설치 했고, 스키마 vector도 생성 했으니 여기는 다시 할 필요 없음

### 🔹 SQL

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

특정 스키마(`vector`)에 설치하려면:

```sql
CREATE EXTENSION IF NOT EXISTS vector SCHEMA vector;
```

### 🔹 plsql 확인

```sql
\dx
```

### 🔹 pgadmin 같은 툴에서 sql로 확인

```sql
SELECT * FROM pg_extension;
```

`vector` 가 보이면 정상 활성화되었다.

---

## 2) 벡터 컬럼 생성

pgvector의 기본 고정길이 벡터 타입은 다음과 같다:

```sql
vector(n)   -- n차원 float32 벡터
```

예: 3차원 벡터 컬럼을 가진 테이블 생성

```sql
CREATE TABLE items (
  id bigserial PRIMARY KEY,
  embedding vector(3)
);
```
- Embedding Vector : 원본 데이터를 AI 모델이 숫자 형태의 벡터로 변환한 결과를 저장하는 컬럼
- vector(3) : 3은 벡터의 차원(dimension)
- 숫자가 커질수록 더 많은 특징을 담는 고차원 벡터 → 정확도 증가, 비용 증가
- 예를 들어 안녕하세요. 가 어떤 숫자로 변환 되는지는 어떤 모델을 사용하는지에 따라 달라짐

| **임베딩 모델**                          | **차원 수** | **설명**                         |
| ----------------------------------- | -------- | ------------------------------ |
| **OpenAI text-embedding-3-small**   | **1536** | 가장 많이 쓰이는 범용 문장 임베딩 모델         |
| **OpenAI text-embedding-3-large**   | **3072** | 더 높은 정확도의 고성능 임베딩              |
| **Sentence Transformers MiniLM-L6** | **384**  | 가볍고 빠르며, CPU 환경에도 적합           |
| **BERT-base**                       | **768**  | 전통적인 NLP 모델, 다양한 한국어/영어 처리에 사용 |
| **KoSentenceBERT (KoSBERT)**        | **768**  | 한국어 의미 기반 검색에 특화된 모델           |


---

## 3) 벡터 삽입 (Insert)

벡터는 문자열 형태(`[1, 2, 3]`)로 삽입한다.

```sql
INSERT INTO items (embedding)
VALUES ('[1.0, 0.0, 0.5]'),
       ('[0.1, 0.9, 0.2]'),
       ('[0.8, 0.1, 0.0]');
```

---

## 4) 최근접 이웃 검색 (Nearest Neighbor Search)

pgvector는 유사도 기반 검색을 지원한다.

유사도 계산 연산자:

- `<->` : L2 거리 - 두 벡터 사이의 직선 거리를 의미하며, 값이 작을수록 더 유사
- `<#>` : Inner product - 두 벡터의 방향과 크기가 얼마나 비슷한지 나타내며, 값이 클수록 더 유사
- `<=>` : Cosine distance - 두 벡터의 각도(방향) 기반 거리로, 벡터의 크기 영향은 줄이고 각도만으로 유사도를 판단하며 값이 작을수록 더 유사

### 🔹 예: 입력 벡터와 가장 가까운 항목 3개 검색 (L2 distance)

```sql
SELECT id, embedding
FROM items
ORDER BY embedding <-> '[0.9, 0.1, 0.0]'
LIMIT 3;
```

---

## 5) 기본 쿼리 예제

### 🔹 L2 거리 계산

```sql
SELECT embedding <-> '[0.2, 0.2, 0.2]' AS distance
FROM items;
```

### 🔹 Cosine similarity 기반 검색

```sql
SELECT *
FROM items
ORDER BY embedding <=> '[1, 0, 0]'
LIMIT 5;
```

### 🔹 벡터 업데이트

```sql
UPDATE items
SET embedding = '[0.9, 0.1, 0.3]'
WHERE id = 1;
```

---