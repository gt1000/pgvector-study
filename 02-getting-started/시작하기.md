# 📘 02. 시작하기 (Getting Started)

pgvector를 처음 사용하는 개발자를 위한 기본 사용 가이드, 아래 순서대로 진행

1\) Extension 활성화
2\) 벡터 컬럼 생성
3\) 벡터 삽입
4\) 최근접 이웃 검색
5\) 기본 쿼리

---

## 1) Extension 활성화

pgvector를 사용하려면 먼저 데이터베이스에서 extension을 활성화해야 한다.

### 🔹 SQL

```sql
CREATE EXTENSION IF NOT EXISTS vector;
```

특정 스키마(`vector`)에 설치하려면:

```sql
CREATE EXTENSION IF NOT EXISTS vector SCHEMA vector;
```

### 🔹 확인

```sql
\dx
```

`vector` 가 보이면 정상 활성화되었다.

---

## 2) 벡터 컬럼 생성

pgvector의 기본 고정길이 벡터 타입은 다음과 같다:

```sql
vector(n)   -- n차원 float32 벡터
```

예: 3차원 벡터 컬럼을 가진 테이블 생성

```sql
CREATE TABLE items (
  id bigserial PRIMARY KEY,
  embedding vector(3)
);
```

---

## 3) 벡터 삽입 (Insert)

벡터는 문자열 형태(`[1, 2, 3]`)로 삽입한다.

```sql
INSERT INTO items (embedding)
VALUES ('[1.0, 0.0, 0.5]'),
       ('[0.1, 0.9, 0.2]'),
       ('[0.8, 0.1, 0.0]');
```

---

## 4) 최근접 이웃 검색 (Nearest Neighbor Search)

pgvector는 유사도 기반 검색을 지원한다.

유사도 계산 연산자:

- `<->` : L2 거리
- `<#>` : Inner product
- `<=>` : Cosine distance

### 🔹 예: 입력 벡터와 가장 가까운 항목 3개 검색 (L2 distance)

```sql
SELECT id, embedding
FROM items
ORDER BY embedding <-> '[0.9, 0.1, 0.0]'
LIMIT 3;
```

---

## 5) 기본 쿼리 예제

### 🔹 L2 거리 계산

```sql
SELECT embedding <-> '[0.2, 0.2, 0.2]' AS distance
FROM items;
```

### 🔹 Cosine similarity 기반 검색

```sql
SELECT *
FROM items
ORDER BY embedding <=> '[1, 0, 0]'
LIMIT 5;
```

### 🔹 특정 차원값 검색

벡터는 배열처럼 접근 가능하다:

```sql
SELECT id
FROM items
WHERE embedding[1] > 0.5;   -- 첫 번째 차원이 0.5보다 큰 경우
```

### 🔹 벡터 업데이트

```sql
UPDATE items
SET embedding = '[0.9, 0.1, 0.3]'
WHERE id = 1;
```

---

# 🎯 요약

| 기능 | 설명 |
|------|------|
| Extension 활성화 | `CREATE EXTENSION vector` |
| 테이블 생성 | `vector(n)` 사용 |
| 벡터 삽입 | `'[1,2,3]'` 형태 |
| 기준 벡터로 유사도 검색 | `ORDER BY embedding <-> '[...]'` |
| 거리 함수 | L2, Cosine, Inner Product |
