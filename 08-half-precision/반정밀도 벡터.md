# 08. ë°˜ì •ë°€ë„ ë²¡í„° (Half-Precision Vectors)

ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì ˆë°˜ìœ¼ë¡œ ì¤„ì´ëŠ” halfvec íƒ€ì… í™œìš©ë²•

> ğŸ¯ **ì´ ë¬¸ì„œì˜ ëª©í‘œ:**  
> ì €ì¥ ê³µê°„ê³¼ ì„±ëŠ¥ì„ ìµœì í™”í•˜ë©´ì„œ ë†’ì€ ì •í™•ë„ë¥¼ ìœ ì§€í•˜ëŠ” ë°©ë²• í•™ìŠµ

---

## 1) halfvec íƒ€ì… ê°œìš”

### halfvecë€?

**halfvec**ëŠ” 16ë¹„íŠ¸ ë¶€ë™ì†Œìˆ˜ì (float16)ì„ ì‚¬ìš©í•˜ëŠ” ë²¡í„° íƒ€ì…ì…ë‹ˆë‹¤.

**ê¸°ë³¸ ë¹„êµ:**

| íƒ€ì… | ë¹„íŠ¸ ìˆ˜ | ì°¨ì›ë‹¹ í¬ê¸° | 768ì°¨ì› í¬ê¸° | ì •ë°€ë„ |
|------|--------|-----------|------------|--------|
| **vector** | 32bit (float32) | 4 bytes | 3,072 bytes (3KB) | ë†’ìŒ |
| **halfvec** | 16bit (float16) | 2 bytes | 1,536 bytes (1.5KB) | ì¤‘ê°„ |
| **bit** | 1bit | 0.125 bytes | 96 bytes | ë‚®ìŒ |

**í•µì‹¬:**
- ì €ì¥ ê³µê°„: **50% ì ˆì•½** âœ…
- ê²€ìƒ‰ ì†ë„: ì•½ê°„ ë¹ ë¦„ (ë°ì´í„° ì „ì†¡ëŸ‰ ê°ì†Œ)
- ì •í™•ë„: 95~99% ìœ ì§€ (ìš©ë„ì— ë”°ë¼ ë‹¤ë¦„)

---

### ì–¸ì œ ì‚¬ìš©í•˜ë‚˜?

```
âœ… ìˆ˜ë°±ë§Œ ê°œ ì´ìƒ ëŒ€ìš©ëŸ‰ ë²¡í„° ì €ì¥
âœ… ë©”ëª¨ë¦¬/ë””ìŠ¤í¬ ê³µê°„ ì œì•½
âœ… 95% ì •í™•ë„ë¡œ ì¶©ë¶„í•œ ê²½ìš°
âœ… ê²€ìƒ‰ ì†ë„ ìµœì í™” í•„ìš”
âŒ ë§¤ìš° ë†’ì€ ì •í™•ë„ í•„ìš” (ê³¼í•™ ê³„ì‚° ë“±)
âŒ ë°ì´í„°ê°€ ì ìŒ (1ë§Œ ê±´ ë¯¸ë§Œ)
```

---

### float16 ì •ë°€ë„

**í‘œí˜„ ë²”ìœ„:**
```
float32: Â±3.4 Ã— 10Â³â¸ (ì•½ 7ìë¦¬ ì •ë°€ë„)
float16: Â±65,504 (ì•½ 3ìë¦¬ ì •ë°€ë„)

ì˜ˆì‹œ:
float32: 0.123456789
float16: 0.1235 (ìë™ ë°˜ì˜¬ë¦¼)
```

**ì£¼ì˜:**
- ë§¤ìš° í° ê°’ì´ë‚˜ ë§¤ìš° ì‘ì€ ê°’ì€ í‘œí˜„ ì œí•œ
- ì„ë² ë”© ëª¨ë¸ì´ ì •ê·œí™”ëœ ë²¡í„°ë¥¼ ìƒì„±í•˜ë©´ ë¬¸ì œì—†ìŒ

---

## 2) halfvec í…Œì´ë¸” ìƒì„±

### â‘  ê¸°ë³¸ í…Œì´ë¸”

```sql
-- halfvec íƒ€ì… ì»¬ëŸ¼
CREATE TABLE paper_chunks_half (
    id BIGSERIAL PRIMARY KEY,
    paper_id TEXT NOT NULL,
    chunk_index INT NOT NULL,
    chunk_text TEXT NOT NULL,
    embedding halfvec(768) NOT NULL,  -- halfvec ì‚¬ìš©
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(paper_id, chunk_index)
);
```

**vector vs halfvec ë¹„êµ:**

```sql
-- vector (float32)
CREATE TABLE docs_full (
    id BIGSERIAL PRIMARY KEY,
    embedding vector(768) NOT NULL  -- 3KB per row
);

-- halfvec (float16)
CREATE TABLE docs_half (
    id BIGSERIAL PRIMARY KEY,
    embedding halfvec(768) NOT NULL  -- 1.5KB per row
);
```

---

### â‘¡ ì €ì¥ ê³µê°„ ë¹„êµ

**1ë°±ë§Œ í–‰ ê¸°ì¤€:**

| íƒ€ì… | í–‰ë‹¹ í¬ê¸° | ì´ í¬ê¸° | ì ˆì•½ |
|------|----------|---------|------|
| vector(768) | 3KB | 3GB | - |
| **halfvec(768)** | 1.5KB | **1.5GB** | **50%** âœ… |

**ì‹¤ì œ ê³„ì‚°:**

```sql
-- í…Œì´ë¸” í¬ê¸° í™•ì¸
SELECT 
    pg_size_pretty(pg_total_relation_size('paper_chunks_full')) AS full_size,
    pg_size_pretty(pg_total_relation_size('paper_chunks_half')) AS half_size;

-- ì˜ˆìƒ ê²°ê³¼:
-- full_size: 3.2GB (ì¸ë±ìŠ¤ í¬í•¨)
-- half_size: 1.6GB (ì¸ë±ìŠ¤ í¬í•¨)
```

---

## 3) halfvec ë°ì´í„° ì‚½ì…

### â‘  ì§ì ‘ ì‚½ì…

```sql
-- ë¬¸ìì—´ë¡œ ì‚½ì…
INSERT INTO paper_chunks_half (paper_id, chunk_index, chunk_text, embedding)
VALUES (
    'paper_001',
    0,
    'ì²­í¬ ë‚´ìš©',
    '[0.1, 0.2, 0.3, ...]'::halfvec(768)  -- halfvecë¡œ ìºìŠ¤íŒ…
);
```

---

### â‘¡ vector â†’ halfvec ë³€í™˜

```sql
-- vector íƒ€ì…ì—ì„œ halfvecë¡œ ìë™ ë³€í™˜
INSERT INTO paper_chunks_half (paper_id, chunk_index, chunk_text, embedding)
SELECT 
    paper_id,
    chunk_index,
    chunk_text,
    embedding::halfvec(768)  -- vectorë¥¼ halfvecë¡œ ë³€í™˜
FROM paper_chunks_full;
```

**ë³€í™˜ ì˜ˆì‹œ:**

```sql
-- ì›ë³¸ (vector)
SELECT embedding FROM paper_chunks_full LIMIT 1;
-- [0.123456789, -0.987654321, ...]

-- ë³€í™˜ í›„ (halfvec)
SELECT embedding FROM paper_chunks_half LIMIT 1;
-- [0.1235, -0.9876, ...]  (ì •ë°€ë„ ê°ì†Œ)
```

---

### â‘¢ Pythonì—ì„œ ì‚½ì…

```python
from sentence_transformers import SentenceTransformer
import psycopg2
import numpy as np

model = SentenceTransformer("jhgan/ko-sbert-sts")
conn = psycopg2.connect(...)
cur = conn.cursor()

# ì„ë² ë”© ìƒì„± (float32)
text = "ë…¼ë¬¸ ì²­í¬ ë‚´ìš©"
embedding_float32 = model.encode(text)  # numpy array (float32)

# halfvecë¡œ ì‚½ì… (PostgreSQLì´ ìë™ ë³€í™˜)
cur.execute("""
    INSERT INTO paper_chunks_half (paper_id, chunk_index, chunk_text, embedding)
    VALUES (%s, %s, %s, %s::halfvec(768))
""", ('paper_001', 0, text, embedding_float32.tolist()))

conn.commit()
```

**ì¤‘ìš”:** Pythonì—ì„œëŠ” float32 ê·¸ëŒ€ë¡œ ë³´ë‚´ê³ , PostgreSQLì´ halfvecë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

---

### â‘£ ëŒ€ëŸ‰ ì‚½ì…

```python
from psycopg2.extras import execute_batch

# ëŒ€ëŸ‰ ë°ì´í„° ì¤€ë¹„
data = []
for i, text in enumerate(texts):
    embedding = model.encode(text).tolist()
    data.append(('paper_001', i, text, embedding))

# Batch Insert
execute_batch(cur, """
    INSERT INTO paper_chunks_half (paper_id, chunk_index, chunk_text, embedding)
    VALUES (%s, %s, %s, %s::halfvec(768))
""", data, page_size=1000)

conn.commit()
```

---

## 4) halfvec ê²€ìƒ‰

### â‘  ê¸°ë³¸ ê²€ìƒ‰

```sql
-- Cosine Distance ê²€ìƒ‰
SELECT 
    chunk_text,
    embedding <=> '[0.1, 0.2, ...]'::halfvec(768) AS distance
FROM paper_chunks_half
WHERE paper_id = 'paper_001'
ORDER BY distance
LIMIT 10;
```

**ì§€ì› ì—°ì‚°ì:**

| ì—°ì‚°ì | ê±°ë¦¬ í•¨ìˆ˜ | halfvec ì§€ì› |
|--------|----------|------------|
| `<=>` | Cosine Distance | âœ… |
| `<->` | L2 Distance | âœ… |
| `<#>` | Inner Product | âœ… |

---

### â‘¡ Pythonì—ì„œ ê²€ìƒ‰

```python
# ì§ˆì˜ ì„ë² ë”© ìƒì„± (float32)
question = "ìµœì  ìˆ˜ì˜¨ì€?"
query_embedding = model.encode(question).tolist()

# halfvec í…Œì´ë¸” ê²€ìƒ‰ (ìë™ ë³€í™˜)
cur.execute("""
    SELECT 
        chunk_text,
        embedding <=> %s::halfvec(768) AS distance
    FROM paper_chunks_half
    WHERE paper_id = %s
    ORDER BY distance
    LIMIT 5
""", (query_embedding, 'paper_001'))

results = cur.fetchall()
```

---

### â‘¢ vector â†” halfvec í˜¼ìš©

```sql
-- vector ì¿¼ë¦¬ë¡œ halfvec í…Œì´ë¸” ê²€ìƒ‰ (ìë™ ë³€í™˜)
SELECT 
    chunk_text,
    embedding <=> '[0.1, 0.2, ...]'::vector(768) AS distance
FROM paper_chunks_half
ORDER BY distance
LIMIT 10;

-- halfvec ì¿¼ë¦¬ë¡œ vector í…Œì´ë¸” ê²€ìƒ‰ (ìë™ ë³€í™˜)
SELECT 
    chunk_text,
    embedding <=> '[0.1, 0.2, ...]'::halfvec(768) AS distance
FROM paper_chunks_full
ORDER BY distance
LIMIT 10;
```

PostgreSQLì´ ìë™ìœ¼ë¡œ íƒ€ì… ë³€í™˜ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.

---

## 5) halfvec ì¸ë±ì‹±

### â‘  HNSW ì¸ë±ìŠ¤

```sql
-- Cosine Distance ì¸ë±ìŠ¤
CREATE INDEX idx_half_embedding_cosine
ON paper_chunks_half
USING hnsw (embedding halfvec_cosine_ops)  -- halfvec ì „ìš© ops
WITH (m = 16, ef_construction = 64);

-- L2 Distance ì¸ë±ìŠ¤
CREATE INDEX idx_half_embedding_l2
ON paper_chunks_half
USING hnsw (embedding halfvec_l2_ops)
WITH (m = 16, ef_construction = 64);

-- Inner Product ì¸ë±ìŠ¤
CREATE INDEX idx_half_embedding_ip
ON paper_chunks_half
USING hnsw (embedding halfvec_ip_ops)
WITH (m = 16, ef_construction = 64);
```

**Operator Class:**

| ê²€ìƒ‰ ì—°ì‚°ì | Operator Class | íƒ€ì… |
|-----------|---------------|------|
| `<=>` | `halfvec_cosine_ops` | halfvec |
| `<->` | `halfvec_l2_ops` | halfvec |
| `<#>` | `halfvec_ip_ops` | halfvec |

---

### â‘¡ IVFFlat ì¸ë±ìŠ¤

```sql
-- IVFFlat ì¸ë±ìŠ¤ (ëŒ€ìš©ëŸ‰)
CREATE INDEX idx_half_embedding_ivf
ON paper_chunks_half
USING ivfflat (embedding halfvec_cosine_ops)
WITH (lists = 100);
```

---

### â‘¢ ì¸ë±ìŠ¤ í¬ê¸° ë¹„êµ

**1ë°±ë§Œ í–‰ ê¸°ì¤€:**

| íƒ€ì… | ì¸ë±ìŠ¤ í¬ê¸° | ì ˆì•½ |
|------|-----------|------|
| vector(768) + HNSW | ~2GB | - |
| **halfvec(768) + HNSW** | **~1GB** | **50%** âœ… |

```sql
-- ì¸ë±ìŠ¤ í¬ê¸° í™•ì¸
SELECT 
    indexname,
    pg_size_pretty(pg_relation_size(indexname::regclass)) AS size
FROM pg_indexes
WHERE tablename IN ('paper_chunks_full', 'paper_chunks_half');
```

---

## 6) ì„±ëŠ¥ ë¹„êµ

### â‘  ê²€ìƒ‰ ì†ë„

**í…ŒìŠ¤íŠ¸ í™˜ê²½:** 1ë°±ë§Œ í–‰, 768ì°¨ì›

| íƒ€ì… | ì¸ë±ìŠ¤ | ê²€ìƒ‰ ì‹œê°„ | ì •í™•ë„ |
|------|-------|----------|--------|
| vector | HNSW | 12ms | 99% |
| **halfvec** | HNSW | **10ms** | 97% |
| vector | ì—†ìŒ | 520ms | 100% |
| halfvec | ì—†ìŒ | 480ms | 100% |

**ê´€ì°°:**
- halfvecê°€ ì•½ê°„ ë¹ ë¦„ (ë°ì´í„° ì „ì†¡ëŸ‰ 50% ê°ì†Œ)
- ì •í™•ë„ëŠ” 2% ê°ì†Œ (ëŒ€ë¶€ë¶„ ìš©ë„ì— ì¶©ë¶„)

---

### â‘¡ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

```sql
-- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë¹„êµ
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS total_size
FROM pg_tables
WHERE tablename IN ('paper_chunks_full', 'paper_chunks_half');
```

**ì˜ˆìƒ ê²°ê³¼ (1ë°±ë§Œ í–‰):**

| í…Œì´ë¸” | ë°ì´í„° | ì¸ë±ìŠ¤ | ì´í•© |
|--------|--------|--------|------|
| paper_chunks_full | 3.0GB | 2.0GB | **5.0GB** |
| paper_chunks_half | 1.5GB | 1.0GB | **2.5GB** |

---

### â‘¢ ì •í™•ë„ í…ŒìŠ¤íŠ¸

```python
import numpy as np
from sentence_transformers import SentenceTransformer

model = SentenceTransformer("jhgan/ko-sbert-sts")

# í…ŒìŠ¤íŠ¸ ë°ì´í„°
texts = ["ë¬¸ì„œ1", "ë¬¸ì„œ2", "ë¬¸ì„œ3", ...]
query = "ê²€ìƒ‰ ì§ˆì˜"

# float32 ì„ë² ë”©
embeddings_f32 = model.encode(texts)
query_f32 = model.encode(query)

# float16 ë³€í™˜
embeddings_f16 = embeddings_f32.astype(np.float16)
query_f16 = query_f32.astype(np.float16)

# Cosine ìœ ì‚¬ë„ ê³„ì‚°
from sklearn.metrics.pairwise import cosine_similarity

sim_f32 = cosine_similarity([query_f32], embeddings_f32)[0]
sim_f16 = cosine_similarity([query_f16], embeddings_f16)[0]

# ìƒìœ„ 10ê°œ ë¹„êµ
top10_f32 = np.argsort(sim_f32)[-10:][::-1]
top10_f16 = np.argsort(sim_f16)[-10:][::-1]

# ì¼ì¹˜ìœ¨ ê³„ì‚°
overlap = len(set(top10_f32) & set(top10_f16))
print(f"ì •í™•ë„: {overlap}/10 = {overlap*10}%")
# ì¼ë°˜ì ìœ¼ë¡œ 8~10/10 = 80~100%
```

---

## 7) vector â†’ halfvec ë§ˆì´ê·¸ë ˆì´ì…˜

### â‘  ê¸°ì¡´ í…Œì´ë¸” ë³€í™˜

```sql
-- Step 1: halfvec í…Œì´ë¸” ìƒì„±
CREATE TABLE paper_chunks_half (
    id BIGSERIAL PRIMARY KEY,
    paper_id TEXT NOT NULL,
    chunk_index INT NOT NULL,
    chunk_text TEXT NOT NULL,
    embedding halfvec(768) NOT NULL,
    metadata JSONB DEFAULT '{}',
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(paper_id, chunk_index)
);

-- Step 2: ë°ì´í„° ë³µì‚¬ (ìë™ ë³€í™˜)
INSERT INTO paper_chunks_half
SELECT 
    id,
    paper_id,
    chunk_index,
    chunk_text,
    embedding::halfvec(768),  -- ë³€í™˜
    metadata,
    created_at
FROM paper_chunks_full;

-- Step 3: ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_half_embedding
ON paper_chunks_half
USING hnsw (embedding halfvec_cosine_ops);

-- Step 4: í™•ì¸
SELECT COUNT(*) FROM paper_chunks_half;
```

---

### â‘¡ ì»¬ëŸ¼ íƒ€ì… ë³€ê²½ (ë¹„ì¶”ì²œ)

```sql
-- ì£¼ì˜: ì‹œê°„ì´ ë§¤ìš° ì˜¤ë˜ ê±¸ë¦¼ (í…Œì´ë¸” ì¬ì‘ì„±)
ALTER TABLE paper_chunks_full
ALTER COLUMN embedding TYPE halfvec(768);

-- ëŒ€ëŸ‰ ë°ì´í„°ì—ì„œëŠ” ìƒˆ í…Œì´ë¸” ìƒì„± ê¶Œì¥
```

---

### â‘¢ ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜

```sql
-- ë°°ì¹˜ë¡œ ë‚˜ëˆ ì„œ ë³µì‚¬ (ëŒ€ìš©ëŸ‰)
DO $$
DECLARE
    batch_size INT := 10000;
    offset_val INT := 0;
    total INT;
BEGIN
    SELECT COUNT(*) INTO total FROM paper_chunks_full;
    
    WHILE offset_val < total LOOP
        INSERT INTO paper_chunks_half
        SELECT 
            id,
            paper_id,
            chunk_index,
            chunk_text,
            embedding::halfvec(768),
            metadata,
            created_at
        FROM paper_chunks_full
        LIMIT batch_size OFFSET offset_val;
        
        offset_val := offset_val + batch_size;
        RAISE NOTICE 'ì§„í–‰: % / %', offset_val, total;
        COMMIT;
    END LOOP;
END $$;
```

---

## 8) ì‹¤ì „ ì‚¬ìš© íŒ¨í„´

### â‘  í•˜ì´ë¸Œë¦¬ë“œ ì „ëµ

```sql
-- ìì£¼ ê²€ìƒ‰: halfvec (ë¹ ë¦„)
CREATE TABLE hot_chunks (
    id BIGSERIAL PRIMARY KEY,
    chunk_text TEXT,
    embedding halfvec(768)
);

-- ë³´ê´€ìš©: vector (ì •í™•)
CREATE TABLE cold_chunks (
    id BIGSERIAL PRIMARY KEY,
    chunk_text TEXT,
    embedding vector(768)
);
```

---

### â‘¡ Two-Tier ê²€ìƒ‰

```sql
-- 1ë‹¨ê³„: halfvecë¡œ ë¹ ë¥´ê²Œ í›„ë³´ ì¶”ì¶œ
WITH candidates AS (
    SELECT id
    FROM paper_chunks_half
    ORDER BY embedding <=> '[...]'::halfvec(768)
    LIMIT 100
)
-- 2ë‹¨ê³„: vectorë¡œ ì •ë°€ ì¬ì •ë ¬
SELECT 
    p.chunk_text,
    p.embedding <=> '[...]'::vector(768) AS distance
FROM paper_chunks_full p
JOIN candidates c ON p.id = c.id
ORDER BY distance
LIMIT 10;
```

---

### â‘¢ í”„ë¡œë•ì…˜ ì„¤ì •

```python
class VectorStore:
    def __init__(self, use_halfvec=True):
        self.use_halfvec = use_halfvec
        self.table = 'paper_chunks_half' if use_halfvec else 'paper_chunks_full'
        self.cast = '::halfvec(768)' if use_halfvec else '::vector(768)'
    
    def search(self, query_embedding, top_k=10):
        cur.execute(f"""
            SELECT chunk_text, embedding <=> %s{self.cast} AS distance
            FROM {self.table}
            ORDER BY distance
            LIMIT %s
        """, (query_embedding, top_k))
        return cur.fetchall()

# ì‚¬ìš©
store = VectorStore(use_halfvec=True)  # halfvec ì‚¬ìš©
results = store.search(query_embedding)
```

---

## 9) ì£¼ì˜ì‚¬í•­

### â‘  ì •ë°€ë„ ì†ì‹¤

```
ì •ë°€ë„ ì†ì‹¤ì´ í° ê²½ìš°:
âŒ ê³¼í•™ ê³„ì‚° (ë†’ì€ ì •ë°€ë„ í•„ìš”)
âŒ ê¸ˆìœµ ë°ì´í„° (ì •í™•í•œ ê°’ í•„ìš”)
âš ï¸ ë§¤ìš° ì‘ì€ ì°¨ì´ ë¹„êµ

ì •ë°€ë„ ì†ì‹¤ì´ ì‘ì€ ê²½ìš°:
âœ… í…ìŠ¤íŠ¸ ê²€ìƒ‰ (ì˜ë¯¸ ìœ ì‚¬ë„)
âœ… ì´ë¯¸ì§€ ê²€ìƒ‰
âœ… ì¶”ì²œ ì‹œìŠ¤í…œ
```

---

### â‘¡ ê°’ ë²”ìœ„ ì œí•œ

```sql
-- float16 ë²”ìœ„: Â±65,504
-- ë²”ìœ„ ì´ˆê³¼ ì‹œ Infinityë¡œ ë³€í™˜ë¨

-- í…ŒìŠ¤íŠ¸
SELECT '[70000]'::halfvec(1);
-- ê²°ê³¼: [Infinity]

-- í•´ê²°: ì •ê·œí™”ëœ ì„ë² ë”© ì‚¬ìš© (ëŒ€ë¶€ë¶„ -1 ~ 1 ë²”ìœ„)
```

---

### â‘¢ íƒ€ì… í˜¼ìš© ì£¼ì˜

```sql
-- âŒ ì˜ëª»ëœ ì˜ˆ: operator class ë¶ˆì¼ì¹˜
CREATE INDEX idx_wrong
ON paper_chunks_half
USING hnsw (embedding vector_cosine_ops);  -- vector ops ì‚¬ìš©

-- âœ… ì˜¬ë°”ë¥¸ ì˜ˆ: halfvec ops ì‚¬ìš©
CREATE INDEX idx_correct
ON paper_chunks_half
USING hnsw (embedding halfvec_cosine_ops);  -- halfvec ops
```

---

## 10) ì„ íƒ ê°€ì´ë“œ

| ìƒí™© | ê¶Œì¥ íƒ€ì… | ì´ìœ  |
|------|----------|------|
| **1ë§Œ ê±´ ë¯¸ë§Œ** | vector | ê³µê°„ ì ˆì•½ íš¨ê³¼ ë¯¸ë¯¸ |
| **10ë§Œ ~ 100ë§Œ ê±´** | halfvec | 50% ê³µê°„ ì ˆì•½ âœ… |
| **100ë§Œ ê±´ ì´ìƒ** | halfvec | í•„ìˆ˜ (ë©”ëª¨ë¦¬/ë¹„ìš©) âœ… |
| **ë†’ì€ ì •í™•ë„ í•„ìš”** | vector | 99%+ ì •í™•ë„ |
| **95% ì •í™•ë„ ì¶©ë¶„** | halfvec | ë¹ ë¥´ê³  íš¨ìœ¨ì  |
| **ë©”ëª¨ë¦¬ ì œì•½** | halfvec | 50% ì ˆì•½ âœ… |

---

## 11) ìš”ì•½

### í•µì‹¬ ì •ë¦¬

```
halfvec = float16 = 16bit

ì¥ì :
âœ… ì €ì¥ ê³µê°„ 50% ì ˆì•½
âœ… ê²€ìƒ‰ ì†ë„ ì•½ê°„ ë¹ ë¦„
âœ… ì¸ë±ìŠ¤ í¬ê¸° 50% ì ˆì•½
âœ… 95~99% ì •í™•ë„ ìœ ì§€

ë‹¨ì :
âš ï¸ ì •ë°€ë„ ì•½ê°„ ê°ì†Œ (3ìë¦¬)
âš ï¸ ê°’ ë²”ìœ„ ì œí•œ (Â±65,504)
```

### ê¸°ë³¸ í…œí”Œë¦¿

```sql
-- 1. í…Œì´ë¸” ìƒì„±
CREATE TABLE paper_chunks (
    id BIGSERIAL PRIMARY KEY,
    paper_id TEXT NOT NULL,
    chunk_text TEXT NOT NULL,
    embedding halfvec(768) NOT NULL  -- halfvec ì‚¬ìš©
);

-- 2. ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_embedding
ON paper_chunks
USING hnsw (embedding halfvec_cosine_ops);

-- 3. ê²€ìƒ‰
SELECT 
    chunk_text,
    embedding <=> %s::halfvec(768) AS distance
FROM paper_chunks
ORDER BY distance
LIMIT 10;
```

---

## ë‹¤ìŒ ë‹¨ê³„

halfvecì„ ì´í•´í–ˆë‹¤ë©´:
1. [09. ì´ì§„ ë²¡í„°](../09-binary-vectors/) - ë” ê·¹ë‹¨ì ì¸ ê³µê°„ ì ˆì•½ (1bit)
2. [13. ì„±ëŠ¥ íŠœë‹](../13-performance/) - ëŒ€ìš©ëŸ‰ ë°ì´í„° ìµœì í™”
3. [07. ì¸ë±ì‹±](../07-indexing/) - halfvec ì¸ë±ìŠ¤ ìƒì„¸ ì„¤ì •